(()=>{"use strict";const e={WORD_EOF:"a word expected, but EOF",WORD_NL:"a word expected, but newline",NOT_NUM:"a number expected, but word ",NL_EOF:"newline expected, but EOF",NL_WORD:"newline expected, but word ",NOT_EQ:"エラー: 入力と出力のreactiveNに齟齬があります。",INFO:"\n(指定しているファイルを間違えているか、正しい方法でoutputのファイルが作成されていない可能性が高いです。ご確認ください。)",GIF_REOPEN:'GIFファイルを作成するには、 このビジュアライザを "file://" ではなく、 "http://" で開かないといけない可能性があります(前者でも大丈夫なこともあります)。 例えば、 "$ python -m SimpleHTTPServer 8000" などとして下さい。',GIF_WAIT:"GIF作成にしばらく時間がかかります。およそ二分ほどです。 (GIFはサイズが大きくなる可能性が高いので、ある程度scaleを小さくしておくことを推奨します。)",DESCRIPTION1:"全体的な設備負荷率やペナルティ、稼働時間を把握するのに適したモードです。<br>縦軸は設備、横軸は週を表しており、それぞれのマスは、上側で平日の情報を、下側で休日の情報を表しています。さらに、各マス内のオブジェクトは、縦方向で設備負荷率を、横方向で稼働時間のタイプを示しています。<br>(ここでは見やすさのため、一週間分の稼働パターンをまとめて表していることに注意してください。本来、一週間は5日分の平日パターンと2日分の休日パターンで構成されています。)<br>そして色は、青から赤になるにつれて、納期遅れ注文数（delayの場合）、もしくは、稼働パターンのコスト（costの場合）が大きいことを示しています。<br>また、scaleを拡大させると文字による情報も追加で現れます。",DESCRIPTION2:"具体的な注文や作業がどのように割り振られているのかを把握するのに適したモードです。<br>縦軸は設備、横軸は週を表しています。<br>特に、delayやcostのモードと異なり、本モードでは正確に設備の稼働パターンを表現していることに注意してください。灰色の部分が設備の稼働時間帯を示しています。色がついている部分は各作業の開始から終了までの時間を示しており、色自体は当該作業とその前の工程の作業との、開始時間の差を表現しています。なお、もし前工程が無ければ時間差は0としています。<br>また、scaleを最大まで拡大させると文字による情報も追加で現れます。",DESCRIPTION3:"基本的にはwork(waiting time)と同じですが、このモードでは色が各注文毎に塗り分けられています。<br>また、scaleを最大まで拡大させると文字による情報も追加で現れます。"},t={WORD_EOF:"a word expected, but EOF",WORD_NL:"a word expected, but newline",NOT_NUM:"a number expected, but word ",NL_EOF:"newline expected, but EOF",NL_WORD:"newline expected, but word ",NOT_EQ:"AssertionError: Input reactiveN and output reactiveN is not equal.",INFO:"\n(It is most likely that you have specified the wrong file or that you have not created the OUTPUT file in the correct way. Please check.)",GIF_REOPEN:'to use this feature, you might have to re-open this file via "http://", instead of "file://". e.g. you can use "$ python -m SimpleHTTPServer 8000"',GIF_WAIT:"please wait for a while, about 2 minutes. (the GIF can be large in size, so we recommend setting the scale as small as possible.)",DESCRIPTION1:"This mode is suitable for seeing overall load factor of machines, penalties, and operating time.<br>The vertical axis represents machines and the horizontal axis represents weeks, with each cell representing weekday information at the top and holiday information at the bottom.<br>In addition, the objects within the cells indicate the load factor of the machine in the vertical direction and the type of operating time in the horizontal direction.<br>(Note that here, for ease of viewing, a week's operating pattern are represented together.Originally, A week consists of a 5-day weekday pattern and a 2-day holiday pattern.)<br>Plus, the color goes from blue to red, indicating the number of delayed orders (in the delay mode) or the cost of the operating pattern (in the cost mode) is larger.<br>When the scale is enlarged, additional textual information appears.",DESCRIPTION2:"This mode is suitable for seeing how specific orders and works are assigned.<br>The vertical axis represents machines and the horizontal axis represents weeks.<br>Note that this mode accurately represents the operating pattern of machines, unlike the delay mode and cost mode.<br>The gray area indicates the machine's operating time period.<br>The colored area indicates the time of each work, and the color itself represents the difference in start time between the work and the work in the previous step. If there is no previous step, the time difference is set to 0.<br>When the scale is enlarged to the maximum, additional textual information appears.",DESCRIPTION3:"This mode is basically the same as the work (waiting time) mode, but in this mode, works of the same order are shown in the same color.<br>When the scale is enlarged to the maximum, additional textual information appears."};var s;!function(e){e[e.EN=0]="EN",e[e.JA=1]="JA"}(s||(s={}));let i=s.JA,n=e;var o,r;!function(e){e.FileParser=class{constructor(e,t){this.filename=e,this.content=[];for(const e of t.split("\n")){const t=e.trim().split(new RegExp("\\s+"));this.content.push(t)}this.y=0,this.x=0}getWord(){this.content.length<=this.y&&this.reportError(n.WORD_EOF),this.content[this.y].length<=this.x&&this.reportError(n.WORD_NL);const e=this.content[this.y][this.x];return this.x+=1,e}getInt(){const e=this.getWord();return e.match(new RegExp("^[-+]?[0-9]+$"))||this.reportError(n.NOT_NUM+JSON.stringify(this.content[this.y][this.x])),parseInt(e)}getNewline(){this.content.length<=this.y&&this.reportError(n.NL_WORD),this.x<this.content[this.y].length&&this.reportError(n.NL_WORD+JSON.stringify(this.content[this.y][this.x])),this.x=0,this.y+=1}unwind(){0==this.x?(this.y-=1,this.x=this.content[this.y].length-1):this.x-=1}reportError(e){throw e=`${this.filename}: line ${this.y+1}: ${e}`,alert(e+n.INFO),new Error(e)}},e.FileSelector=class{constructor(){this.inputFile=document.getElementById("inputFile"),this.outputFile=document.getElementById("outputFile"),this.reloadButton=document.getElementById("reloadButton"),this.inputDoneButton=document.getElementById("inputDoneButton"),this.check_box=document.getElementById("inputCheckbox"),this.seed_input=document.getElementById("inputSeedNumber"),this.check_box.addEventListener("change",this.onChangeCheck.bind(this)),this.seed_input.addEventListener("change",this.onChangeSeed.bind(this)),this.generated_inputContent="",this.inputTextArea=document.getElementById("inputContainer"),this.outputTextArea=document.getElementById("outputContainer"),this.reloadFilesClosure=()=>{this.reloadFiles()},this.inputFile.addEventListener("change",this.reloadFilesClosure),this.outputFile.addEventListener("change",this.reloadFilesClosure),this.reloadButton.addEventListener("click",this.reloadFilesClosure),this.inputDoneButton.addEventListener("click",this.reloadFilesClosure)}onChangeSeed(){const e=parseInt(this.seed_input.value,10);this.generated_inputContent=Module.ccall("generate_input","string",["number"],[e]),this.inputTextArea.innerHTML=this.generated_inputContent.split("\n").slice(0,4).join("\n")+"\n..."}onChangeCheck(){const e=document.getElementById("inputCheckbox"),t=document.getElementById("hidden_area");e.checked?(t.style.display="block",this.inputFile.disabled=!0,this.outputFile.disabled=!0,this.onChangeSeed()):(t.style.display="none",this.inputFile.disabled=!1,this.outputFile.disabled=!1)}reloadFiles(){if(this.check_box.checked){if(""==this.generated_inputContent)throw alert("Input is not generated. Please reload the page and try again."),new Error("Input is not generated.");const e=this.generated_inputContent,t=this.outputTextArea.value;this.reloadButton.classList.remove("disabled"),void 0!==this.callback&&this.callback(e,t)}else{if(0==this.inputFile.files.length||0==this.outputFile.files.length)return;t(this.inputFile.files[0],(e=>{t(this.outputFile.files[0],(t=>{this.inputFile.removeEventListener("change",this.reloadFilesClosure),this.outputFile.removeEventListener("change",this.reloadFilesClosure),this.reloadButton.classList.remove("disabled"),void 0!==this.callback&&this.callback(e,t)}))}))}}},e.RichSeekBar=class{constructor(){this.seekRange=document.getElementById("seekRange"),this.seekNumber=document.getElementById("seekNumber"),this.fpsInput=document.getElementById("fpsInput"),this.firstButton=document.getElementById("firstButton"),this.prevButton=document.getElementById("prevButton"),this.playButton=document.getElementById("playButton"),this.nextButton=document.getElementById("nextButton"),this.lastButton=document.getElementById("lastButton"),this.runIcon=document.getElementById("runIcon"),this.intervalId=null,this.now_running=!1,this.setMinMax(-1,-1),this.seekRange.addEventListener("change",(()=>{this.setValue(parseInt(this.seekRange.value))})),this.seekNumber.addEventListener("change",(()=>{this.setValue(parseInt(this.seekNumber.value)-1)})),this.seekRange.addEventListener("input",(()=>{this.setValue(parseInt(this.seekRange.value))})),this.seekNumber.addEventListener("input",(()=>{this.setValue(parseInt(this.seekNumber.value)-1)})),this.fpsInput.addEventListener("change",(()=>{null!==this.intervalId&&this.play()})),this.firstButton.addEventListener("click",(()=>{this.stop(),this.setValue(this.getMin())})),this.prevButton.addEventListener("click",(()=>{this.stop(),this.setValue(this.getValue()-1)})),this.nextButton.addEventListener("click",(()=>{this.stop(),this.setValue(this.getValue()+1)})),this.lastButton.addEventListener("click",(()=>{this.stop(),this.setValue(this.getMax())})),this.playClosure=()=>{this.play()},this.stopClosure=()=>{this.stop()},this.playButton.addEventListener("click",this.playClosure)}setMinMax(e,t){this.seekRange.min=e.toString(),this.seekNumber.min=(e+1).toString(),this.seekRange.max=t.toString(),this.seekNumber.max=(t+1).toString(),this.seekRange.step=this.seekNumber.step="1",this.setValue(e)}getMin(){return parseInt(this.seekRange.min)}getMax(){return parseInt(this.seekRange.max)}setValue(e){isNaN(e)||(e=Math.max(this.getMin(),Math.min(this.getMax(),e)),this.seekRange.value=e.toString(),this.seekNumber.value=(e+1).toString(),void 0!==this.callback&&this.callback(e))}getValue(){return parseInt(this.seekRange.value)}getDelay(){const e=parseInt(this.fpsInput.value);return Math.floor(1e3/e)}resetInterval(){void 0!==this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}play(){this.playButton.removeEventListener("click",this.playClosure),this.playButton.addEventListener("click",this.stopClosure),this.runIcon.classList.remove("play"),this.runIcon.classList.add("stop"),this.now_running=!0,this.getValue()==this.getMax()&&this.setValue(this.getMin()),this.resetInterval(),this.intervalId=window.setInterval((()=>{this.getValue()==this.getMax()?this.stop():this.setValue(this.getValue()+1)}),this.getDelay())}stop(){this.playButton.removeEventListener("click",this.stopClosure),this.playButton.addEventListener("click",this.playClosure),this.runIcon.classList.remove("stop"),this.runIcon.classList.add("play"),this.now_running=!1,this.resetInterval()}};const t=(e,t)=>{const s=new FileReader;s.readAsText(e),s.onloadend=function(){null==s.result||s.result instanceof ArrayBuffer||t(s.result)}},s=(e,t)=>{const s=document.createElement("a");s.href=e,s.download=t;const i=document.createEvent("MouseEvent");i.initEvent("click",!0,!0),s.dispatchEvent(i)};e.FileExporter=class{constructor(e,t){const i=document.getElementById("saveAsImage"),o=document.getElementById("saveAsVideo");i.addEventListener("click",(()=>{s(e.toDataURL("image/png"),"canvas.png")})),o.addEventListener("click",(()=>{if(location.href.match(new RegExp("^file://"))&&alert(n.GIF_REOPEN),t.stop(),confirm(n.GIF_WAIT)){const i=new GIF({quality:10,repeat:-1});for(let s=t.getMin();s<=t.getMax();++s)console.log(`gif progress: ${s}/${t.getMax()}`),t.setValue(s),i.addFrame(e,{copy:!0,delay:t.getDelay()});i.on("finished",(function(e){s(URL.createObjectURL(e),"canvas.gif")})),i.render()}}))}}}(o||(o={})),function(e){const t=86400,s=7*t;class i{constructor(){this.pattern=[[],[[32400,43200]],[[46800,64800]],[[32400,43200],[46800,64800]],[[32400,43200],[46800,72e3]],[[32400,43200],[46800,79200]],[[32400,43200],[46800,86400]],[[32400,43200],[46800,93600]],[[32400,43200],[46800,100800]]]}addcalendar(e,i,n,o){let r=s*i;for(let s=0;s<5;s++)this.pattern[n].forEach((t=>{e.push([t[0]+r,t[1]+r])})),r+=t;for(let s=0;s<2;s++)this.pattern[o].forEach((t=>{e.push([t[0]+r,t[1]+r])})),r+=t}}class r{}class a{constructor(){this.costRatio=1,this.calendar1CostRatio=1,this.calendar0CostRatio=0,this.resDemand=0}}class l{constructor(){this.prodTime=[]}}class h{constructor(e){this.addCostHoliday=.48,this.itemList=[],this.resourceList=[],this.opList=[],this.costTypeA=new Map,this.costTypeB=new Map;const t=new o.FileParser("<input-file>",e);this.week=t.getInt(),t.getNewline(),this.rescalendarChangeLimitN=t.getInt(),t.getNewline(),this.reactiveN=t.getInt(),t.getNewline(),this.itemN=t.getInt(),t.getNewline();for(let e=0;e<this.itemN;e++){const e=new r;e.itemNo=t.getInt(),e.itemProcN=t.getInt(),t.getNewline(),e.prodTimeRange=[0,0],e.prodTimeRange[0]=t.getInt(),e.prodTimeRange[1]=t.getInt(),t.getNewline(),e.proc=Array(e.itemProcN);for(let s=0;s<e.itemProcN;s++)e.proc[s]=t.getInt();t.getNewline(),this.itemList.push(e)}this.resourceN=t.getInt(),t.getNewline();for(let e=0;e<this.resourceN;e++){const e=new a;e.resNo=t.getInt(),t.getNewline(),e.procNo=t.getInt(),e.resDemand=t.getInt(),e.workerN=t.getInt(),e.costPerHour=t.getInt(),e.costPerHourNight=t.getInt(),t.getNewline(),e.costRatio=Number(t.getWord()),e.calendar0CostRatio=Number(t.getWord()),e.calendar1CostRatio=Number(t.getWord()),t.getNewline(),e.calendarTypeXRatio=[];for(let s=0;s<9;s++)e.calendarTypeXRatio.push(Number(t.getWord()));t.getNewline(),this.resourceList.push(e)}this.operationN=t.getInt(),t.getNewline();for(let e=0;e<this.operationN;e++){const e=new l;e.opNo=t.getInt(),e.itemNo=t.getInt(),e.let=t.getInt(),t.getNewline();const s=this.itemList[e.itemNo].itemProcN;e.prodTime=Array(s);for(let i=0;i<s;i++)e.prodTime[i]=t.getInt();t.getNewline(),this.opList.push(e)}const s=t.getInt();t.getNewline();for(let e=0;e<s;e++){const s=Math.floor(e/9),i=e%9,n=t.getInt(),o=t.getInt();t.getNewline(),this.costTypeA.set([s,i].join(","),n),this.costTypeB.set([s,i].join(","),o)}this.procN=t.getInt(),t.getNewline(),this.procDemand=Array(this.procN);for(let e=0;e<this.procN;e++)this.procDemand[e]=parseFloat(t.getWord()),t.getNewline();this.calendar=Array(this.resourceN),this.originalcalendar=Array(this.resourceN);for(let e=0;e<this.resourceN;e++){const s=t.getInt();t.getNewline(),this.calendar[e]=Array(s);for(let i=0;i<s;i++){const s=t.getInt(),n=t.getInt();this.calendar[e][i]=[s,n],t.getNewline()}for(let e=0;e<this.resourceN;e++)this.originalcalendar[e]=t.getWord(),t.getNewline()}this.addCostHoliday=parseFloat(t.getWord()),t.getNewline(),console.log("input done.")}GetResourceTotalTime(e){let t=new Map,i=0;return e.forEach((e=>{e.forEach((e=>{if(!(e[0]<e[1])){const e="Assertion Error: !(j[0] < j[1])";throw alert(e),new Error(e)}const n=[i,Math.floor((e[0]-14400)/s)].join(",");t.has(n)?t.set(n,t.get(n)+e[1]-e[0]):t.set(n,e[1]-e[0])})),i++})),t}sequenceForward(e,t){const i=Array(this.resourceN).fill(0),n=Array(this.resourceN).fill(0),o=this.GetResourceTotalTime(e),r=new Map,a=new Map,l=new Map,h=new Map;let c=0;for(let e=0;e<this.resourceN;e++){if(t[e].length!=2*this.week){const e="Assertion Error: strcalendar[i].length() != week * 2";throw alert(e),new Error(e)}let s=0;for(let i=0;i<2*this.week-2;i++)t[e][i]!=t[e][i+2]&&s++;c+=Math.max(0,s-this.rescalendarChangeLimitN)}for(let e=0;e<this.resourceN;e++)for(let t=0;t<this.week;t++)r.set([e,t].join(","),0),a.set([e,t].join(","),0);const u=this;function d(t,o){let c=[[-1,0]],d=1,p=Array(u.itemList[t.itemNo].itemProcN);for(let e=0;e<p.length;e++)p[e]=[];for(let a=0;a<u.itemList[t.itemNo].itemProcN;a++){const g=u.itemList[t.itemNo].proc[a],m=t.prodTime[a];let f=m;for(c.forEach((t=>{const s=t[0],o=t[1],r=Math.floor((o-s)*m/d);let l=r;f-=r;let h=Math.max(s,i[g]);for(;e[g][n[g]][1]<=h+.1;)n[g]++;for(h=Math.max(h,e[g][n[g]][0]);l>.1;){let t=0,s=0;o-h>=l-.1?(s=o,t=s-l):(t=h,s=t+l),s>=e[g][n[g]][1]-.1&&(s=e[g][n[g]][1],n[g]++,h=e[g][n[g]][0]),i[g]=s,l-=s-t,p[a].push([t,s])}}));f>.1;){const t=i[g],s=t;let o=t+f;o>=e[g][n[g]][1]-.1&&(o=e[g][n[g]][1],n[g]++),i[g]=o,f-=o-s,p[a].push([s,o])}const _=p[a].slice(-1)[0][1];let w=n[g];for(f=m,p[a].length=0;f>.1;){for(;e[g][w][0]>=_-.1;)w--;let t=e[g][w][0];const s=Math.min(e[g][w][1],_);s-t>f+.1&&(t=s-f),w--,f-=s-t,p[a].push([t,s])}let I=[];p[a].reverse(),p[a].forEach((e=>{const t=e[0],i=e[1];I.length>0&&I[I.length-1]===Math.min(s*u.week+21600,t)?(I.pop(),I.push(Math.min(s*u.week+21600,i))):(I.push(Math.min(s*u.week+21600,t)),I.push(Math.min(s*u.week+21600,i)));const n=Math.floor((t-14400)/s);if(n<u.week){const e=[g,n].join(",");r.has(e)?r.set(e,r.get(e)+i-t):r.set(e,i-t)}})),c=p[a],d=m,I.sort(((e,t)=>e<t?-1:1)),l.set([o,a].join(","),g),h.set([o,a].join(","),I)}const g=c.slice(-1)[0][1]>t.let;if(g){const e=new Set;let i=0;p.forEach((n=>{const o=u.itemList[t.itemNo].proc[i];n.forEach((t=>{const i=t[0],n=Math.floor((i-14400)/s);n<u.week&&e.add([o,n])})),i++})),e.forEach((e=>{const t=e.join(",");a.has(t)?a.set(t,a.get(t)+1):a.set(t,1)}))}return g}let p=0;for(let e=0;e<this.operationN;e++)p+=!0===d(this.opList[e],e)?1:0;const g=new Map;return r.forEach(((e,t)=>{if(isNaN(e)){const e="Assertion Error: NaN found";throw alert(e),new Error(e)}t.slice(t.search(","))!=this.week.toString()&&(o.has(t)||o.set(t,0),g.set(t,e/Math.max(1,o.get(t))))})),[p,c,g,a,l,h]}}class c{constructor(e){this.queries=[];const t=new o.FileParser("<output-file>",e);t.getInt(),t.getNewline(),this.resoucesN=t.getInt(),this.weeks=t.getInt();const s=t.getInt();t.getNewline(),this.queries=Array(s);for(let e=0;e<s;e++){this.queries[e]=Array(this.resoucesN);for(let s=0;s<this.resoucesN;s++){const i=t.getWord();if(i.length!=2*this.weeks)throw console.log(i),alert(`query:${e+1} resource:${s+1}\noutput is not correct format.`),new Error("AssertionError");for(let t=0;t<i.length;t++){const n=parseInt(i.charAt(t));if(!(1<=n&&n<=9))throw console.log(n),alert(`query:${e+1} resource:${s+1}\noutput is not correct format.`),new Error("AssertionError")}this.queries[e][s]=i,t.getNewline()}}console.log("output done.")}}class u{constructor(e,t,s,i){this.penalty=new Map,this.age=s,this.query=t.queries[s],this.calendar=Array(e.resourceN);for(let e=0;e<this.calendar.length;e++)this.calendar[e]=[];let n=0;for(let t=0;t<e.resourceN;t++)for(let s=0;s<e.week;s++){const o=parseInt(this.query[t].slice(2*s,2*s+1),10)-1,r=parseInt(this.query[t].slice(2*s+1,2*s+2),10)-1;i.addcalendar(this.calendar[t],s,o,r);let a=e.costTypeA.get([t,o].join(",")),l=e.costTypeB.get([t,r].join(","));isNaN(a)&&(a=0),isNaN(l)&&(l=0),n+=a+l,this.penalty.set([t,s].join(","),a+l)}for(let t=0;t<e.resourceN;t++)this.calendar[t].push([1e9,2e9]);const o=e.sequenceForward(this.calendar,this.query),r=o[0],a=o[1];this.loadRate=o[2],this.letOpCount=o[3],this.vis1_resource=o[4],this.vis2_optimes=o[5],this.vis3_waiting_time=new Map;for(var l=0;l<e.operationN;l++)for(var h=0;h<e.itemList[e.opList[l].itemNo].itemProcN;h++){const e=[l,h].join(",");0==h?this.vis3_waiting_time.set(e,0):this.vis3_waiting_time.set(e,this.vis2_optimes.get(e)[0]-this.vis2_optimes.get([l,h-1].join(","))[0])}const c=Array.from(this.vis3_waiting_time.values());c.sort(((e,t)=>e-t));let u=0;for(;u<c.length&&!(c[u]>0);u++);this.vis3_waiting_time_mid=2*c[Math.floor((u+c.length-2)/2)],this.vis3_waiting_time_mid=Math.max(1,this.vis3_waiting_time_mid);const d=r+a==0?Math.round(1e9*(10-Math.log10(n/e.week))):0;this.score=d}}class d{constructor(e,t){if(this.frames=[],this.input=new h(e),this.output=new c(t),this.bestScore=0,this.input.reactiveN!=this.output.queries.length)throw alert(n.NOT_EQ+n.INFO),new Error(n.NOT_EQ);const s=new i;for(let e=0;e<this.input.reactiveN;e++){const t=new u(this.input,this.output,e,s);this.frames.push(t),this.bestScore=Math.max(this.bestScore,t.score)}console.log("Tester done.")}}class p{constructor(){this.scale_level=8,this.scales=[.2,.3,.4,.5,.6,.7,.8,.9,1,2,3,4,5,7.5,10,15],this.color_palette=[0,2048/19,4096/19,1280/19,3328/19,512/19,2560/19,4608/19,1792/19,3840/19,1024/19,3072/19,256/19,2304/19,4352/19,1536/19,3584/19,768/19,2816/19],this.canvas=document.getElementById("canvas"),this.canvas.height=800,this.canvas.width=800;const e=this.canvas.getContext("2d");null!=e?(this.ctx=e,this.week_Input=document.getElementById("week_Input"),this.expansion_plus=document.getElementById("expansion_plus"),this.expansion_minus=document.getElementById("expansion_minus"),this.operationcon_cf_Input=document.getElementById("operationcon_colorful"),this.operationcon_rb_Input=document.getElementById("operationcon_rb"),this.letonly_Input=document.getElementById("letonly"),this.cost_Input=document.getElementById("cost"),this.itemN_Input=document.getElementById("chlim_Input"),this.resourceN_Input=document.getElementById("resourceN_Input"),this.score_this_frame_Input=document.getElementById("score_now_frame_Input"),this.score_Input=document.getElementById("score_Input")):alert("unsupported browser")}draw_operation(e,t,s,i,n,o,r){if(r)this.ctx.fillStyle=o?`hsl(${this.color_palette[n%this.color_palette.length]},80%,60%)`:`hsl(${this.color_palette[n%this.color_palette.length]},80%,60%,20%)`;else{const e=255,t=31,s=31,i=30,r=144,a=255,l=Math.floor((e-i)*n+i),h=Math.floor((t-r)*n+r),c=Math.floor((s-a)*n+a);this.ctx.fillStyle=o?`rgb(${l},${h},${c})`:`rgba(${l},${h},${c},0.2)`}this.ctx.fillRect(e,s,t,i)}draw_calendar_color_map(e,t,s,i,n,o,r){r=Math.min(Math.max(r,0),255);const a=Math.floor(225*r/256+30),l=Math.floor(-113*r/256+144),h=Math.floor(-224*r/256+255);this.draw_calendar(e,t,s,i,n,o,a,l,h)}draw_calendar(e,t,s,i,n,o,r,a,l){if(e-=6*s/24,this.ctx.strokeRect(e+6*s/24,t,s,i),this.ctx.fillStyle=`rgb(${r}, ${a}, ${l})`,i=Math.floor(i/10+9*i*o/10),1==n);else if(2==n)this.ctx.fillRect(e+9*s/24,t,3*s/24,i);else if(3==n)this.ctx.fillRect(e+13*s/24,t,5*s/24,i);else if(4==n)this.ctx.fillRect(e+9*s/24,t,3*s/24,i),this.ctx.fillRect(e+13*s/24,t,5*s/24,i);else if(5==n)this.ctx.fillRect(e+9*s/24,t,3*s/24,i),this.ctx.fillRect(e+13*s/24,t,7*s/24,i);else if(6==n)this.ctx.fillRect(e+9*s/24,t,3*s/24,i),this.ctx.fillRect(e+13*s/24,t,9*s/24,i);else if(7==n)this.ctx.fillRect(e+9*s/24,t,3*s/24,i),this.ctx.fillRect(e+13*s/24,t,11*s/24,i);else if(8==n)this.ctx.fillRect(e+9*s/24,t,3*s/24,i),this.ctx.fillRect(e+13*s/24,t,13*s/24,i);else{if(9!=n){const e=`Invalid calendar type: ${n+1}`;throw alert(e),new Error(e)}this.ctx.fillRect(e+9*s/24,t,3*s/24,i),this.ctx.fillRect(e+13*s/24,t,15*s/24,i)}}draw(e,t){this.week_Input.value=t.input.week.toString(),this.itemN_Input.value=t.input.rescalendarChangeLimitN.toString(),this.resourceN_Input.value=t.input.resourceN.toString(),this.score_this_frame_Input.value=e.score.toLocaleString(),this.score_Input.value=t.bestScore.toLocaleString();const s=110,i=60,n=100,o=70,r=this.scales[this.scale_level],a=1.25,l=t.input.week*n*r+s+70,h=t.input.resourceN*o+i+10;this.canvas.width=l*a,this.canvas.height=h*a,this.ctx.scale(a,a),this.canvas.style.width=l+"px",this.canvas.style.height=h+"px",this.ctx.fillStyle="white",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="20px serif",this.ctx.fillStyle="Black",this.ctx.textAlign="center",this.ctx.fillText((e.age+1).toString()+"/"+t.input.reactiveN.toString(),55,30);for(let e=0;e<t.input.week;e++)this.ctx.fillText((this.scale_level>4?"week":"")+(e+1).toString().padStart(2,"0"),(e+.5)*n*r+s,30);for(let e=0;e<t.input.resourceN;e++)this.ctx.fillText((this.scale_level>4?"machine":"")+(e+1).toString().padStart(2,"0"),55,(e+.5)*o+i);if(this.letonly_Input.checked){this.ctx.font="12px serif";for(var c=0;c<t.input.resourceN;c++)for(var u=0;u<t.input.week;u++){const t=[c,u].join(",");this.draw_calendar_color_map(u*n*r+s,c*o+i,n*r,250/7,parseInt(e.query[c].slice(2*u,2*u+1)),e.loadRate.get(t),Math.floor(255-510/(2+e.letOpCount.get(t)))),this.draw_calendar_color_map(u*n*r+s,c*o+250/7+i,n*r,100/7,parseInt(e.query[c].slice(2*u+1,2*u+2)),e.loadRate.get(t),Math.floor(255-510/(2+e.letOpCount.get(t)))),this.scale_level>=9&&this.ctx.fillText("delay:"+e.letOpCount.get(t).toString()+"/loadRate:"+(100*Math.min(1,e.loadRate.get(t))).toFixed(1)+"%",(u+.5)*n*r+s,(c+.93)*o+i)}}if(this.cost_Input.checked)for(this.ctx.font="12px serif",c=0;c<t.input.resourceN;c++)for(u=0;u<t.input.week;u++){const t=[c,u].join(",");this.draw_calendar_color_map(u*n*r+s,c*o+i,n*r,250/7,parseInt(e.query[c].slice(2*u,2*u+1)),e.loadRate.get(t),Math.floor(255-510/(2+e.penalty.get(t)/1e6))),this.draw_calendar_color_map(u*n*r+s,c*o+250/7+i,n*r,100/7,parseInt(e.query[c].slice(2*u+1,2*u+2)),e.loadRate.get(t),Math.floor(255-510/(2+e.penalty.get(t)/1e6))),this.scale_level>=9&&this.ctx.fillText("cost:"+e.penalty.get(t).toString()+"/loadRate:"+Math.round(100*Math.min(1,e.loadRate.get(t))).toString()+"%",(u+.5)*n*r+s,(c+.93)*o+i)}if(this.operationcon_cf_Input.checked||this.operationcon_rb_Input.checked){if(this.scale_level>=9){this.ctx.font="15px serif";for(let e=0;e<t.input.week;e++)for(let t=0;t<7;t++)this.ctx.fillText("day"+(t+1).toString(),(e+(t+.5)/7)*n*r+s,52.5)}for(c=0;c<t.input.resourceN;c++)for(u=0;u<t.input.week;u++){for(var d=0;d<5;d++)this.draw_calendar(n*r*(u+d/7)+s,c*o+i,n*r/7,50,parseInt(e.query[c].slice(2*u,2*u+1)),1,200,200,200);for(d=5;d<7;d++)this.draw_calendar(n*r*(u+d/7)+s,c*o+i,n*r/7,50,parseInt(e.query[c].slice(2*u+1,2*u+2)),1,175,175,175)}if(this.scale_level==this.scales.length-1){this.ctx.font="8px serif",this.ctx.fillStyle="Black";for(let e=0;e<t.input.resourceN;e++)this.ctx.fillText("op index % 100",55,(e+1)*o-10+i)}for(c=0;c<t.input.operationN;c++)for(u=0;u<t.input.itemList[t.input.opList[c].itemNo].itemProcN;u++){const t=[c,u].join(","),n=e.vis2_optimes.get(t);console.assert(n.length%2==0);for(let a=0;a<n.length-1;a++)a%2==0?this.draw_operation((n[a]-21600)/6048*r+s,(n[a+1]/6048-n[a]/6048)*r,e.vis1_resource.get(t)*o+i,40,this.operationcon_cf_Input.checked?c:Math.min(1,e.vis3_waiting_time.get(t)/e.vis3_waiting_time_mid),!0,this.operationcon_cf_Input.checked):this.draw_operation((n[a]-21600)/6048*r+s,(n[a+1]/6048-n[a]/6048)*r,e.vis1_resource.get(t)*o+i,40,this.operationcon_cf_Input.checked?c:Math.min(1,e.vis3_waiting_time.get(t)/e.vis3_waiting_time_mid),!1,this.operationcon_cf_Input.checked);this.scale_level==this.scales.length-1&&this.ctx.fillText(((c+1)%100).toString(),((n[0]+n[n.length-1])/2-21600)/6048*r+s,e.vis1_resource.get(t)*o+50+10+i)}}}getCanvas(){return this.canvas}}e.App=class{constructor(){this.visualizer=new p,this.loader=new o.FileSelector,this.seek=new o.RichSeekBar,this.exporter=new o.FileExporter(this.visualizer.getCanvas(),this.seek),this.seek.callback=e=>{void 0!==this.tester&&this.visualizer.draw(this.tester.frames[e],this.tester)},this.loader.callback=(e,t)=>{this.tester=new d(e,t),this.seek.setMinMax(0,this.tester.frames.length-1),this.seek.setValue(0),this.seek.play()}}}}(r||(r={})),window.onload=()=>{const o=new r.App,a=document.getElementById("lang_ja_button"),l=document.getElementById("lang_en_button");a.onclick=()=>{a.classList.add("teal"),l.classList.remove("teal"),i=s.JA,n=e},l.onclick=()=>{a.classList.remove("teal"),l.classList.add("teal"),i=s.EN,n=t},document.getElementById("modal_button").addEventListener("click",(function(){document.getElementById("description1").innerHTML=n.DESCRIPTION1,document.getElementById("description2").innerHTML=n.DESCRIPTION2,document.getElementById("description3").innerHTML=n.DESCRIPTION3,$(".ui.modal").modal("setting","transition","fade up").modal("show")}));const h=o.visualizer;h.letonly_Input.onchange=()=>{o.seek.getValue()===o.seek.getMax()&&o.seek.play()},h.cost_Input.onchange=()=>{o.seek.getValue()===o.seek.getMax()&&o.seek.play()},h.operationcon_cf_Input.onchange=()=>{h.operationcon_cf_Input.checked&&h.scale_level<11&&(0==h.scale_level&&(h.expansion_minus.disabled=!1),h.scale_level=11),o.seek.getValue()===o.seek.getMax()&&o.seek.play()},h.operationcon_rb_Input.onchange=()=>{h.operationcon_rb_Input.checked&&h.scale_level<11&&(0==h.scale_level&&(h.expansion_minus.disabled=!1),h.scale_level=11),o.seek.getValue()===o.seek.getMax()&&o.seek.play()},h.expansion_minus.onclick=()=>{h.scale_level==h.scales.length-1&&(h.expansion_plus.disabled=!1),h.scale_level>0&&h.scale_level--,0==h.scale_level&&(h.expansion_minus.disabled=!0),o.seek.now_running||h.draw(o.tester.frames[o.seek.getValue()],o.tester)},h.expansion_plus.onclick=()=>{0==h.scale_level&&(h.expansion_minus.disabled=!1),h.scale_level<h.scales.length-1&&h.scale_level++,h.scale_level==h.scales.length-1&&(h.expansion_plus.disabled=!0),o.seek.now_running||h.draw(o.tester.frames[o.seek.getValue()],o.tester)}}})();